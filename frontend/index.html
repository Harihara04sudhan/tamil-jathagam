<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamil Jathagam - Vedic Astrology System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            padding: 20px;
        }
        
        .south-indian-chart {
            width: 400px;
            height: 400px;
            position: relative;
            border: 3px solid #333;
            transform: rotate(45deg);
            background: #fff;
        }
        
        .house {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            border: 1px solid #666;
            background: #f9f9f9;
            transform: rotate(-45deg);
            padding: 5px;
            overflow: hidden;
        }
        
        .house-content {
            line-height: 1.3;
        }
        
        .planet-item {
            color: #667eea;
            font-size: 10px;
            margin: 2px 0;
        }
        
        /* South Indian chart house positions */
        .house-1 { width: 50%; height: 50%; left: 25%; top: 0; }
        .house-2 { width: 25%; height: 25%; right: 50%; top: 0; }
        .house-3 { width: 25%; height: 25%; right: 25%; top: 0; }
        .house-4 { width: 25%; height: 25%; right: 0; top: 0; }
        .house-5 { width: 25%; height: 25%; right: 0; top: 25%; }
        .house-6 { width: 25%; height: 25%; right: 0; top: 50%; }
        .house-7 { width: 50%; height: 50%; left: 25%; bottom: 0; }
        .house-8 { width: 25%; height: 25%; left: 25%; bottom: 0; }
        .house-9 { width: 25%; height: 25%; left: 0; bottom: 0; }
        .house-10 { width: 25%; height: 25%; left: 0; top: 50%; }
        .house-11 { width: 25%; height: 25%; left: 0; top: 25%; }
        .house-12 { width: 25%; height: 25%; left: 0; top: 0; }
        
        .predictions-grid {
            display: grid;
            gap: 15px;
        }
        
        .prediction-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .prediction-card h4 {
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .prediction-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        
        .prediction-factor {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .dasha-timeline {
            margin-top: 20px;
        }
        
        .dasha-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .dasha-current {
            background: #e7f3ff;
            border-left-color: #2196F3;
        }
        
        .yoga-dosha-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .yoga-dosha-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .yoga-card, .dosha-card {
            padding: 15px;
            border-radius: 10px;
        }
        
        .yoga-card {
            background: #e8f5e9;
            border: 2px solid #4caf50;
        }
        
        .dosha-card {
            background: #ffebee;
            border: 2px solid #f44336;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .info-table th, .info-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .info-table th {
            background: #f5f5f5;
            font-weight: 600;
        }
        
        .rasi-tamil {
            color: #e91e63;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const API_BASE_URL = 'http://localhost:8000';
        
        function App() {
            const [formData, setFormData] = useState({
                name: '',
                date: '',
                time: '',
                place: '',
                latitude: 13.0827,
                longitude: 80.2707,
                timezone: 'Asia/Kolkata'
            });
            
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [chartData, setChartData] = useState(null);
            const [activeTab, setActiveTab] = useState('chart');
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError(null);
                
                try {
                    const response = await fetch(`${API_BASE_URL}/api/birth-chart`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: formData.name,
                            date: formData.date,
                            time: formData.time,
                            place: formData.place,
                            latitude: parseFloat(formData.latitude),
                            longitude: parseFloat(formData.longitude),
                            timezone: formData.timezone
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Failed to calculate birth chart');
                    }
                    
                    const data = await response.json();
                    setChartData(data);
                } catch (err) {
                    setError(err.message);
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="container">
                    <div className="header">
                        <h1>üåü ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‡Æú‡Ææ‡Æ§‡Æï‡ÆÆ‡Øç üåü</h1>
                        <h1>Tamil Jathagam - Vedic Astrology System</h1>
                        <p>Complete Birth Chart Analysis with Horoscope Predictions</p>
                        <p style={{marginTop: '15px'}}>
                            <a href="porutham.html" style={{color: 'white', textDecoration: 'none', background: 'rgba(255,255,255,0.2)', padding: '10px 20px', borderRadius: '8px', display: 'inline-block', transition: 'all 0.3s'}}>
                                üíë ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ≤‡Øç - Marriage Compatibility
                            </a>
                        </p>
                    </div>
                    
                    <div className="main-content">
                        <div className="card">
                            <h2 style={{marginBottom: '20px'}}>Birth Details</h2>
                            <form onSubmit={handleSubmit}>
                                <div className="form-group">
                                    <label>Name</label>
                                    <input
                                        type="text"
                                        name="name"
                                        value={formData.name}
                                        onChange={handleInputChange}
                                        placeholder="Enter name"
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>Birth Date *</label>
                                    <input
                                        type="date"
                                        name="date"
                                        value={formData.date}
                                        onChange={handleInputChange}
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>Birth Time * (24-hour format)</label>
                                    <input
                                        type="time"
                                        name="time"
                                        value={formData.time}
                                        onChange={handleInputChange}
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>Birth Place</label>
                                    <input
                                        type="text"
                                        name="place"
                                        value={formData.place}
                                        onChange={handleInputChange}
                                        placeholder="e.g., Chennai, Tamil Nadu"
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>Latitude *</label>
                                    <input
                                        type="number"
                                        step="0.0001"
                                        name="latitude"
                                        value={formData.latitude}
                                        onChange={handleInputChange}
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>Longitude *</label>
                                    <input
                                        type="number"
                                        step="0.0001"
                                        name="longitude"
                                        value={formData.longitude}
                                        onChange={handleInputChange}
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>Timezone</label>
                                    <select
                                        name="timezone"
                                        value={formData.timezone}
                                        onChange={handleInputChange}
                                    >
                                        <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
                                        <option value="America/New_York">America/New_York (EST)</option>
                                        <option value="Europe/London">Europe/London (GMT)</option>
                                        <option value="Asia/Dubai">Asia/Dubai (GST)</option>
                                    </select>
                                </div>
                                
                                <button type="submit" className="btn" disabled={loading}>
                                    {loading ? 'Calculating...' : 'Calculate Jathagam'}
                                </button>
                            </form>
                        </div>
                        
                        <div className="card">
                            {error && (
                                <div className="error">
                                    <strong>Error:</strong> {error}
                                </div>
                            )}
                            
                            {loading && (
                                <div className="loading">
                                    <div className="spinner"></div>
                                    <p>Calculating your Jathagam...</p>
                                </div>
                            )}
                            
                            {chartData && (
                                <>
                                    <div className="tabs">
                                        <button 
                                            className={`tab ${activeTab === 'chart' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('chart')}
                                        >
                                            Birth Chart
                                        </button>
                                        <button 
                                            className={`tab ${activeTab === 'positions' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('positions')}
                                        >
                                            Planetary Positions
                                        </button>
                                        <button 
                                            className={`tab ${activeTab === 'predictions' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('predictions')}
                                        >
                                            Predictions
                                        </button>
                                        <button 
                                            className={`tab ${activeTab === 'dasha' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('dasha')}
                                        >
                                            Dasha Periods
                                        </button>
                                        <button 
                                            className={`tab ${activeTab === 'yogas' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('yogas')}
                                        >
                                            Yogas & Doshas
                                        </button>
                                    </div>
                                    
                                    {activeTab === 'chart' && <ChartView data={chartData} />}
                                    {activeTab === 'positions' && <PositionsView data={chartData} />}
                                    {activeTab === 'predictions' && <PredictionsView data={chartData} />}
                                    {activeTab === 'dasha' && <DashaView data={chartData} />}
                                    {activeTab === 'yogas' && <YogasView data={chartData} />}
                                </>
                            )}
                            
                            {!chartData && !loading && !error && (
                                <div style={{textAlign: 'center', padding: '60px 20px', color: '#999'}}>
                                    <h3>Enter birth details to generate Jathagam</h3>
                                    <p style={{marginTop: '10px'}}>Complete birth chart with predictions will appear here</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        function ChartView({ data }) {
            const ascendant = data.ascendant.rasi;
            const positions = data.planetary_positions;
            
            // Group planets by rasi
            const rasiPlanets = {};
            for (let i = 1; i <= 12; i++) {
                rasiPlanets[i] = [];
            }
            
            // Add Ascendant
            rasiPlanets[ascendant].push('Asc');
            
            // Add planets
            Object.entries(positions).forEach(([planet, pos]) => {
                const shortName = planet === 'Mercury' ? 'Mer' : 
                                 planet === 'Jupiter' ? 'Jup' :
                                 planet === 'Saturn' ? 'Sat' :
                                 planet === 'Rahu' ? 'Rah' :
                                 planet === 'Ketu' ? 'Ket' :
                                 planet.substring(0, 3);
                rasiPlanets[pos.rasi].push(shortName);
            });
            
            // Get house number for each rasi based on ascendant
            const getHouseForRasi = (rasiNum) => {
                return ((rasiNum - ascendant + 12) % 12) + 1;
            };
            
            return (
                <div>
                    <h3 style={{marginBottom: '20px', textAlign: 'center'}}>
                        South Indian Style Chart
                    </h3>
                    <p style={{textAlign: 'center', marginBottom: '20px'}}>
                        Ascendant: <span className="rasi-tamil">
                            {data.ascendant.rasi_name.en} ({data.ascendant.rasi_name.ta})
                        </span>
                    </p>
                    
                    <div className="chart-container">
                        <div className="south-indian-chart">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].map(house => {
                                // In South Indian chart, house 1 is always at top (Lagna)
                                // Calculate which rasi is in this house
                                const rasiNum = ((ascendant + house - 2) % 12) + 1;
                                const planets = rasiPlanets[rasiNum] || [];
                                
                                return (
                                    <div key={house} className={`house house-${house}`}>
                                        <div className="house-content">
                                            <div style={{fontSize: '8px', color: '#999'}}>H{house}</div>
                                            {planets.map((p, i) => (
                                                <div key={i} className="planet-item">{p}</div>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    
                    <div style={{marginTop: '30px'}}>
                        <h4>Legend:</h4>
                        <p style={{fontSize: '14px', color: '#666', marginTop: '10px'}}>
                            <strong>Asc</strong> = Ascendant (Lagna)<br/>
                            <strong>Sun</strong> = ‡Æö‡ØÇ‡Æ∞‡Æø‡ÆØ‡Æ©‡Øç | <strong>Moon</strong> = ‡Æö‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡Æ©‡Øç | <strong>Mar</strong> = ‡Æö‡ØÜ‡Æµ‡Øç‡Æµ‡Ææ‡ÆØ‡Øç | <strong>Mer</strong> = ‡Æ™‡ØÅ‡Æ§‡Æ©‡Øç<br/>
                            <strong>Jup</strong> = ‡Æï‡ØÅ‡Æ∞‡ØÅ | <strong>Ven</strong> = ‡Æö‡ØÅ‡Æï‡Øç‡Æ∞‡Æ©‡Øç | <strong>Sat</strong> = ‡Æö‡Æ©‡Æø | <strong>Rah</strong> = ‡Æ∞‡Ææ‡Æï‡ØÅ | <strong>Ket</strong> = ‡Æï‡Øá‡Æ§‡ØÅ
                        </p>
                    </div>
                </div>
            );
        }
        
        function PositionsView({ data }) {
            return (
                <div>
                    <h3 style={{marginBottom: '20px'}}>Planetary Positions</h3>
                    
                    <table className="info-table">
                        <thead>
                            <tr>
                                <th>Planet</th>
                                <th>Rasi (Sign)</th>
                                <th>Nakshatra</th>
                                <th>Degrees</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style={{background: '#e3f2fd'}}>
                                <td><strong>Ascendant (Lagna)</strong></td>
                                <td>
                                    {data.ascendant.rasi_name.en}<br/>
                                    <span className="rasi-tamil">{data.ascendant.rasi_name.ta}</span>
                                </td>
                                <td>
                                    {data.ascendant.nakshatra}<br/>
                                    <span className="rasi-tamil">{data.ascendant.nakshatra_tamil}</span>
                                </td>
                                <td>{data.ascendant.degrees_in_rasi.toFixed(2)}¬∞</td>
                            </tr>
                            {Object.entries(data.planetary_positions).map(([planet, pos]) => (
                                <tr key={planet}>
                                    <td><strong>{planet}</strong></td>
                                    <td>
                                        {pos.rasi_name.en}<br/>
                                        <span className="rasi-tamil">{pos.rasi_name.ta}</span>
                                    </td>
                                    <td>
                                        {pos.nakshatra} (Pada {pos.pada})<br/>
                                        <span className="rasi-tamil">{pos.nakshatra_tamil}</span>
                                    </td>
                                    <td>
                                        {pos.degrees_in_rasi.toFixed(2)}¬∞
                                        {pos.is_retrograde && ' (R)'}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        }
        
        function PredictionsView({ data }) {
            const predictions = data.predictions;
            
            return (
                <div>
                    <h3 style={{marginBottom: '20px'}}>Horoscope Predictions</h3>
                    
                    <div className="predictions-grid">
                        {Object.entries(predictions).map(([category, items]) => (
                            items.length > 0 && (
                                <div key={category} className="prediction-card">
                                    <h4>{category.charAt(0).toUpperCase() + category.slice(1).replace('_', ' ')}</h4>
                                    {items.map((item, idx) => (
                                        <div key={idx} className="prediction-item">
                                            <div className="prediction-factor">{item.factor}</div>
                                            <div style={{fontSize: '14px', color: '#555'}}>{item.description}</div>
                                        </div>
                                    ))}
                                </div>
                            )
                        ))}
                    </div>
                </div>
            );
        }
        
        function DashaView({ data }) {
            const dashas = data.vimshottari_dasha;
            const today = new Date();
            
            return (
                <div>
                    <h3 style={{marginBottom: '20px'}}>Vimshottari Dasha Periods</h3>
                    <p style={{marginBottom: '20px', color: '#666'}}>
                        The 120-year cycle of planetary periods based on birth nakshatra
                    </p>
                    
                    <div className="dasha-timeline">
                        {dashas.slice(0, 5).map((dasha, idx) => {
                            const endDate = new Date(dasha.end_date);
                            const isCurrent = endDate > today && idx === 0;
                            
                            return (
                                <div key={idx} className={`dasha-item ${isCurrent ? 'dasha-current' : ''}`}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap'}}>
                                        <div>
                                            <h4>{dasha.planet} Mahadasha</h4>
                                            <p className="rasi-tamil">{dasha.planet_tamil} ‡ÆÆ‡Æï‡Ææ‡Æ§‡Æö‡Øà</p>
                                        </div>
                                        <div style={{textAlign: 'right'}}>
                                            <div style={{fontSize: '14px', fontWeight: '600'}}>
                                                {dasha.years.toFixed(1)} years
                                            </div>
                                            {isCurrent && (
                                                <div style={{color: '#2196F3', fontWeight: '600', marginTop: '5px'}}>
                                                    CURRENT PERIOD
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div style={{marginTop: '10px', fontSize: '13px', color: '#666'}}>
                                        {dasha.start_date} to {dasha.end_date}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }
        
        function YogasView({ data }) {
            return (
                <div>
                    <h3 style={{marginBottom: '20px'}}>Yogas & Doshas</h3>
                    
                    <div className="yoga-dosha-grid">
                        <div>
                            <h4 style={{marginBottom: '15px', color: '#4caf50'}}>Beneficial Yogas</h4>
                            {data.yogas.length > 0 ? (
                                data.yogas.map((yoga, idx) => (
                                    <div key={idx} className="yoga-card" style={{marginBottom: '10px'}}>
                                        <h5 style={{marginBottom: '5px'}}>{yoga.name}</h5>
                                        <p style={{fontSize: '13px', marginBottom: '5px'}}>
                                            Type: {yoga.type}
                                        </p>
                                        <p style={{fontSize: '14px', color: '#555'}}>
                                            {yoga.description}
                                        </p>
                                        <div style={{marginTop: '5px', fontWeight: '600', color: '#2e7d32'}}>
                                            Strength: {yoga.strength}
                                        </div>
                                    </div>
                                ))
                            ) : (
                                <p style={{color: '#999'}}>No major yogas detected</p>
                            )}
                        </div>
                        
                        <div>
                            <h4 style={{marginBottom: '15px', color: '#f44336'}}>Doshas (Afflictions)</h4>
                            {data.doshas.length > 0 ? (
                                data.doshas.map((dosha, idx) => (
                                    <div key={idx} className="dosha-card" style={{marginBottom: '10px'}}>
                                        <h5 style={{marginBottom: '5px'}}>{dosha.name}</h5>
                                        <p style={{fontSize: '13px', marginBottom: '5px'}}>
                                            Severity: {dosha.severity}
                                        </p>
                                        <p style={{fontSize: '14px', color: '#555'}}>
                                            {dosha.description}
                                        </p>
                                    </div>
                                ))
                            ) : (
                                <p style={{color: '#999'}}>No major doshas detected</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
